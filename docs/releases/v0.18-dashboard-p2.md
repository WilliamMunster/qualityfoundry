# v0.18-dashboard-p2 Release Notes

**发布日期**: 2026-01-26  
**Git 标签**: `v0.18-dashboard-p2`  
**Main SHA**: `0d78bd4`

---

## 概述

L5 Dashboard P2 完成，包含趋势可视化增强、策略对比视图、数据准确性护栏。

---

## 新功能

### P2-2: Policy 版本对比视图增强

- **当前策略风险卡片**: 显示 hash、version，域分组摘要 (tools/budget/high_risk)
- **安全告警**: 工具白名单为空时显示 warning
- **Collapsible 域配置摘要面板**

### P2-3: Dashboard 趋势可视化增强

- **SVG 折线图**: Total (蓝实线) + Fail+HITL (红虚线)
- **Hover Tooltip**: 日期、Total、Pass、Fail、HITL 详情
- **CSV 导出**: 点击按钮下载 `trend_7d_YYYY-MM-DD.csv`
- **异常标注**: 较 7 日均值偏离 2x 时显示 ⚠️

### P2-4: Dashboard 数据准确性护栏

新增 6 个 contract tests:
- `test_timeseries_total_equals_decision_sum` (严格等式)
- `test_by_decision_matches_cards` (聚合一致性)
- `test_days_boundary_min_1` / `test_limit_boundary_min_1` (边界测试)
- `test_days_0_invalid` / `test_limit_0_invalid` (422 验证)

---

## CI 门禁

新增 `dashboard-contracts` required check，与 `smoke-fast`、`unit-tests`、`mcp-security` 同级。

---

## 文件变更

| 文件 | 变更 |
|------|------|
| `frontend/src/pages/DashboardPage.tsx` | +447/-139 lines |
| `backend/tests/test_api_contract_dashboard_summary.py` | +109 lines |
| `.github/workflows/ci.yml` | +28 lines (dashboard-contracts job) |

---

## 验收命令

```bash
cd backend && ruff check . && pytest -q --tb=short  # All passed
cd frontend && npm run build  # ✓ built
pytest tests/test_api_contract_dashboard_summary.py -q  # 18 passed
```

---

## 升级说明

无破坏性变更。直接拉取 `main@0d78bd4` 或 checkout `v0.18-dashboard-p2` tag。
